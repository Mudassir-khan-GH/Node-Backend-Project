<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | SnapFix</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gray-50">
  <!-- üåê Navbar -->
  <nav class="bg-white shadow-md py-3 px-6 fixed top-0 left-0 right-0 z-10">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <h1 class="text-2xl font-bold text-blue-600 tracking-wide">SnapFix.</h1>

      <!-- Hamburger Button (mobile) -->
      <button id="menu-btn" class="sm:hidden text-gray-700 focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <!-- Links (desktop) -->
      <div id="nav-links" class="hidden sm:flex gap-5">
        <a href="/api/v1/post/userPosts" class="text-gray-700 font-medium hover:text-blue-600 transition">My Posts</a>
        <a href="/api/v1/user/profile" class="text-gray-700 font-medium hover:text-blue-600 transition">Profile</a>
        <a href="/api/v1/user/logout" class="text-gray-700 font-medium hover:text-red-600 transition">Logout</a>
      </div>
    </div>

    <!-- Links (mobile dropdown) -->
    <div id="mobile-menu" class="hidden flex-col gap-3 mt-3 sm:hidden">
      <a href="/api/v1/post/userPosts" class="block text-gray-700 font-medium hover:text-blue-600 transition">My Posts</a>
      <a href="/api/v1/user/profile" class="block text-gray-700 font-medium hover:text-blue-600 transition">Profile</a>
      <a href="/api/v1/user/logout" class="block text-gray-700 font-medium hover:text-red-600 transition">Logout</a>
    </div>
  </nav>

  <!-- Main content -->
  <main class="pt-24 px-4 pb-8 flex flex-col items-center">
    <!-- üßç User Info Section -->
    <div class="flex items-center gap-4 bg-white border border-gray-200 shadow-sm rounded-xl p-4 w-full max-w-2xl mb-6">
      <img src="<%= user?.image%>" alt="User Avatar" class="w-12 h-12 rounded-full object-cover border border-blue-300" />
      <div>
        <h2 class="text-lg font-semibold text-gray-800"><%= user?.username%></h2>
        <p class="text-sm text-gray-500"><%= user?.email%></p>
      </div>
    </div>

    <!-- ‚úçÔ∏è Create Post Card -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-5 w-full max-w-2xl mb-6">
      <form class="space-y-4" method="POST" action="/api/v1/post/createPost" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Title goes here...." class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-400 focus:outline-none">
        <textarea name="description" placeholder="Give a brief description of the issue..." class="w-full border border-gray-300 rounded-lg p-3 resize-none focus:ring-2 focus:ring-blue-400 focus:outline-none" rows="3"></textarea>

        <div class="flex items-center justify-between">
          <input type="file" name="image" accept="image/*" class="text-sm text-gray-700" />
          <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition">Post</button>
        </div>
      </form>
    </div>

    <!-- üì∞ Posts Feed Section -->
    <div class="w-full max-w-2xl space-y-6">
      <% allPosts.forEach(record => { %>
        <% if(record.creator.length > 0){ %>
          <!-- Post Card -->
          <div id="<%= record._id %>" class="bg-white border border-gray-200 shadow-sm rounded-xl p-5">
            <!-- Post Header -->
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-3">
                <img src="<%=record.creator[0].image%>" alt="User" class="w-10 h-10 rounded-full object-cover border border-blue-300" />
                <div>
                  <h3 class="font-semibold text-gray-800"><%= record.creator[0].username%></h3>
                  <p class="text-xs text-gray-500"><%=record.createdAt.toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' , timeZone: 'Asia/Karachi'}) %></p>
                </div>
              </div>
              
              <!-- Follow Button -->
              <div>
                <% if(record.isCurrentUserFollowed){ %>
                  <a href="/api/v1/follower/unFollow/<%=user._id%>/<%=record.creator[0]._id%>" class="inline-block text-blue-600 px-3 py-1 font-semibold bg-gray-200 rounded-md hover:bg-gray-300 transition">
                    Followed
                  </a>
                <% } else { %>
                  <a href="/api/v1/follower/follow/<%=user._id%>/<%=record.creator[0]._id%>" class="inline-block bg-blue-600 px-3 py-1 font-semibold text-white rounded-md hover:bg-blue-700 transition">
                    Follow
                  </a>
                <% } %>
              </div>
            </div>

            <!-- Post Content -->
            <h3 class="font-semibold text-gray-900 mb-2"><%= record.title%></h3>
            <p class="text-gray-700 mb-3"><%= record.description %></p>
            
            <!-- Post Image -->
            <img src="<%= record.image %>" alt="Post Image" class="rounded-lg border border-gray-200 w-full object-cover mb-3" style="max-height: 400px;" />

            <!-- Post Actions -->
            <div class="flex items-center mt-3">
              <% if(record.isCurrentUserLiked){ %>
                <span class="text-blue-600 font-medium">üëç <%=record.likes%> Upvotes</span>
              <% } else { %>
                <a href="/api/v1/like/add/<%=user?._id%>/<%=record._id%>" class="text-gray-600 hover:text-blue-600 font-medium transition">
                  üëç <%=record.likes%> Upvotes
                </a>
              <% } %>
            </div>
          </div>
        <% } %>
      <% }) %>
    </div>
  </main>

  <script>
    const menuBtn = document.getElementById("menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");

    menuBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  </script>
</body>

</html>